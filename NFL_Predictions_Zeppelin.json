{"paragraphs":[{"text":"%angular\n<center>\n    <img src=\"https://github.com/zaratsian/Spark/raw/master/nfl_banner2.png\">\n</center>","user":"anonymous","dateUpdated":"2017-10-31T14:18:09+0000","config":{"colWidth":12,"enabled":false,"results":{},"editorSetting":{"language":"scala","editOnDblClick":true},"editorMode":"ace/mode/undefined","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"ANGULAR","data":"<center>\n    <img src=\"https://github.com/zaratsian/Spark/raw/master/nfl_banner2.png\">\n</center>"}]},"apps":[],"jobName":"paragraph_1508951489987_1168111664","id":"20171025-171129_438264698","dateCreated":"2017-10-25T17:11:29+0000","dateStarted":"2017-10-25T17:13:25+0000","dateFinished":"2017-10-25T17:13:25+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:497"},{"title":"Load Libraries","text":"%livy.pyspark\n\nimport datetime, time \nimport re, random, sys\nfrom pyspark.sql.types import StructType, StructField, ArrayType, IntegerType, StringType, FloatType, LongType\nfrom pyspark.sql.functions import struct, array, lit, monotonically_increasing_id, col, expr, when, concat, udf, split, size, lag, count, isnull\nfrom pyspark.sql import Window\nfrom pyspark.ml.linalg import Vectors\nfrom pyspark.ml.regression import GBTRegressor, LinearRegression, GeneralizedLinearRegression, RandomForestRegressor\nfrom pyspark.ml.classification import GBTClassifier, RandomForestClassifier\nfrom pyspark.ml.feature import VectorIndexer, VectorAssembler, StringIndexer\nfrom pyspark.ml.evaluation import RegressionEvaluator\nfrom pyspark.ml import Pipeline, PipelineModel\nfrom pyspark.ml.evaluation import MulticlassClassificationEvaluator, RegressionEvaluator\n","user":"anonymous","dateUpdated":"2017-11-06T02:14:25+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<hr/>Spark Application Id: application_1509554242062_0007<br/>Spark WebUI: <a href=\"http://edwdemo0.field.hortonworks.com:8088/proxy/application_1509554242062_0007/\">http://edwdemo0.field.hortonworks.com:8088/proxy/application_1509554242062_0007/</a>"}]},"apps":[],"jobName":"paragraph_1508951566772_1735939743","id":"20171025-171246_2021163045","dateCreated":"2017-10-25T17:12:46+0000","dateStarted":"2017-11-06T02:14:26+0000","dateFinished":"2017-11-06T02:14:27+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:498"},{"text":"%md\n# Data Ingestion","user":"anonymous","dateUpdated":"2017-11-06T02:15:02+0000","config":{"colWidth":12,"enabled":false,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Data Ingestion</h1>\n</div>"}]},"apps":[],"jobName":"paragraph_1509413987993_-978327189","id":"20171031-013947_1413326815","dateCreated":"2017-10-31T01:39:47+0000","dateStarted":"2017-11-06T02:14:50+0000","dateFinished":"2017-11-06T02:14:58+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:499"},{"text":"%sh\n// Peeking into data\ncurl -i -L \"http://edwdemo0.field.hortonworks.com:50070/webhdfs/v1/data/NFLPlaybyPlay2015.csv?op=OPEN\" | tail -n 5","user":"anonymous","dateUpdated":"2017-11-06T02:15:39+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false},"editorMode":"ace/mode/sh"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"bash: //: Is a directory\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\r  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\n\r 13 14.7M   13 2056k    0     0  2397k      0  0:00:06 --:--:--  0:00:06 2397k\r100 14.7M  100 14.7M    0     0  14.7M      0 --:--:-- --:--:-- --:--:-- 89.8M\n\"389412\",2016-01-03,\"2016010310\",22,4,4,\"00:43\",1,43,7,\"GB\",42,58,10,12,0,1,\"GB\",\"MIN\",\"(:43) (No Huddle, Shotgun) A.Rodgers pass short middle to R.Rodgers to MIN 46 for 12 yards (C.Munnerlyn; A.Sendejo).\",1,12,0,0,NA,NA,NA,0,NA,\"Pass\",\"A.Rodgers\",1,\"Complete\",\"Short\",\"middle\",0,NA,NA,0,NA,NA,\"R.Rodgers\",1,NA,NA,NA,\"C.Munnerlyn\",\"A.Sendejo\",NA,NA,0,NA,NA,0,0,NA,0,NA,NA,NA,0,13,19,-6,6,2015\n\"391814\",2016-01-03,\"2016010310\",22,4,1,\"00:27\",1,27,16,\"MIN\",46,46,10,19,0,0,\"GB\",\"MIN\",\"(:27) (No Huddle) A.Rodgers pass short right to D.Adams pushed ob at MIN 39 for 7 yards (T.Newman).\",1,7,0,0,NA,NA,NA,0,NA,\"Pass\",\"A.Rodgers\",1,\"Complete\",\"Short\",\"right\",0,NA,NA,0,NA,NA,\"D.Adams\",1,NA,NA,NA,\"T.Newman\",NA,NA,NA,0,NA,NA,0,0,NA,0,NA,NA,NA,0,13,19,-6,6,2015\n\"394216\",2016-01-03,\"2016010310\",22,4,2,\"00:24\",1,24,3,\"MIN\",39,39,3,19,0,0,\"GB\",\"MIN\",\"(:24) (No Huddle, Shotgun) A.Rodgers pass incomplete deep left to J.Jones.\",1,0,0,0,NA,NA,NA,0,NA,\"Pass\",\"A.Rodgers\",1,\"Incomplete Pass\",\"Deep\",\"left\",0,NA,NA,0,NA,NA,\"J.Jones\",0,NA,NA,NA,NA,NA,NA,NA,0,NA,NA,0,0,NA,0,NA,NA,NA,0,13,19,-6,6,2015\n\"396414\",2016-01-03,\"2016010310\",22,4,3,\"00:15\",1,15,9,\"MIN\",39,39,3,20,0,0,\"GB\",\"MIN\",\"(:15) (No Huddle, Shotgun) A.Rodgers pass short left to R.Rodgers to MIN 38 for 1 yard (X.Rhodes).\",1,1,0,0,NA,NA,NA,0,NA,\"Pass\",\"A.Rodgers\",1,\"Complete\",\"Short\",\"left\",0,NA,NA,0,NA,NA,\"R.Rodgers\",1,NA,NA,NA,\"X.Rhodes\",NA,NA,NA,0,NA,NA,0,0,NA,0,NA,NA,NA,0,13,19,-6,6,2015\n\"39949\",2016-01-03,\"2016010310\",22,4,4,\"00:01\",1,1,14,\"MIN\",38,38,2,20,0,0,\"GB\",\"MIN\",\"(:01) (No Huddle, Shotgun) A.Rodgers pass incomplete deep left to J.Jones (A.Barr).\",1,0,0,0,NA,NA,NA,0,NA,\"Pass\",\"A.Rodgers\",1,\"Incomplete Pass\",\"Deep\",\"left\",0,NA,NA,0,NA,NA,\"J.Jones\",0,NA,NA,NA,NA,NA,NA,NA,0,NA,NA,0,0,NA,0,NA,NA,NA,0,13,19,-6,6,2015\n"}]},"apps":[],"jobName":"paragraph_1509415957993_-1902473265","id":"20171031-021237_35245211","dateCreated":"2017-10-31T02:12:37+0000","dateStarted":"2017-11-06T02:15:40+0000","dateFinished":"2017-11-06T02:15:46+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:500"},{"title":"Load Data from Remote HDP Cluster (from HDFS)","text":"%livy.pyspark\n\nrawdata = spark.read.load('hdfs://edwdemo0.field.hortonworks.com:8020/data/NFLPlaybyPlay2015.csv', format=\"csv\", header=True, inferSchema=True)\n\nprint '\\nTotal Records: ' + str(rawdata.count()) + '\\n'\nfor i in rawdata.dtypes: print i\n\nrawdata = rawdata.select( [rawdata['`'+c+'`'].alias(c.replace('.','_')) for c in rawdata.columns] )\n","user":"anonymous","dateUpdated":"2017-11-06T02:16:23+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Total Records: 46129\n\n('_c0', 'int')\n('Date', 'timestamp')\n('GameID', 'int')\n('Drive', 'int')\n('qtr', 'int')\n('down', 'string')\n('time', 'string')\n('TimeUnder', 'int')\n('TimeSecs', 'string')\n('PlayTimeDiff', 'string')\n('SideofField', 'string')\n('yrdln', 'string')\n('yrdline100', 'string')\n('ydstogo', 'int')\n('ydsnet', 'int')\n('GoalToGo', 'string')\n('FirstDown', 'string')\n('posteam', 'string')\n('DefensiveTeam', 'string')\n('desc', 'string')\n('PlayAttempted', 'int')\n('Yards.Gained', 'int')\n('sp', 'int')\n('Touchdown', 'int')\n('ExPointResult', 'string')\n('TwoPointConv', 'string')\n('DefTwoPoint', 'string')\n('Safety', 'int')\n('PuntResult', 'string')\n('PlayType', 'string')\n('Passer', 'string')\n('PassAttempt', 'int')\n('PassOutcome', 'string')\n('PassLength', 'string')\n('PassLocation', 'string')\n('InterceptionThrown', 'int')\n('Interceptor', 'string')\n('Rusher', 'string')\n('RushAttempt', 'int')\n('RunLocation', 'string')\n('RunGap', 'string')\n('Receiver', 'string')\n('Reception', 'int')\n('ReturnResult', 'string')\n('Returner', 'string')\n('BlockingPlayer', 'string')\n('Tackler1', 'string')\n('Tackler2', 'string')\n('FieldGoalResult', 'string')\n('FieldGoalDistance', 'string')\n('Fumble', 'int')\n('RecFumbTeam', 'string')\n('RecFumbPlayer', 'string')\n('Sack', 'int')\n('Challenge.Replay', 'int')\n('ChalReplayResult', 'string')\n('Accepted.Penalty', 'int')\n('PenalizedTeam', 'string')\n('PenaltyType', 'string')\n('PenalizedPlayer', 'string')\n('Penalty.Yards', 'int')\n('PosTeamScore', 'string')\n('DefTeamScore', 'string')\n('ScoreDiff', 'string')\n('AbsScoreDiff', 'string')\n('Season', 'int')"},{"type":"HTML","data":"<hr/>Spark Application Id: application_1509554242062_0007<br/>Spark WebUI: <a href=\"http://edwdemo0.field.hortonworks.com:8088/proxy/application_1509554242062_0007/\">http://edwdemo0.field.hortonworks.com:8088/proxy/application_1509554242062_0007/</a>"}]},"apps":[],"jobName":"paragraph_1508951707060_1375261458","id":"20171025-171507_414414517","dateCreated":"2017-10-25T17:15:07+0000","dateStarted":"2017-11-06T02:16:23+0000","dateFinished":"2017-11-06T02:16:41+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:501"},{"text":"%md\n# Data Wrangling: Cleaning , Transformations, Enrichment\n","user":"anonymous","dateUpdated":"2017-11-06T02:16:49+0000","config":{"colWidth":12,"enabled":false,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Data Wrangling: Cleaning , Transformations, Enrichment</h1>\n</div>"}]},"apps":[],"jobName":"paragraph_1509416158902_177184840","id":"20171031-021558_172295346","dateCreated":"2017-10-31T02:15:58+0000","dateStarted":"2017-10-31T14:18:11+0000","dateFinished":"2017-10-31T14:18:11+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:502"},{"title":"Data Cleaning & Transformations","text":"%livy.pyspark\n\ncolumns_to_keep =   [   \n                    \"Date\", \"GameID\", \"Drive\", \"qtr\", \"down\", \"time\", \"TimeUnder\", \"TimeSecs\", \n                    \"PlayTimeDiff\", \"yrdline100\", \"ydstogo\", \"ydsnet\", \"FirstDown\",\n                    \"Yards_Gained\", \"Touchdown\", \"PlayType\", \"PassLength\", \n                    \"PassLocation\", \"RunLocation\",\n                    \"posteam\", \"DefensiveTeam\",\n                    #\"Passer\", \"Rusher\", \"InterceptionThrown\", \"Season\"\n                    \"PosTeamScore\", \"DefTeamScore\"\n                    ]\n\n# Filter columns (keep)\nnfldata = rawdata.select(columns_to_keep)\n\n# Drop rows with NAa:\nnfldata = nfldata.filter(nfldata.down != 'NA')\n\n# approxQuantile\nnfldata.approxQuantile(col='Yards_Gained', probabilities=[0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0], relativeError=0.05)\n\n# Filter target variable (Yards_Gained) to remove outliers\nnfldata = nfldata.filter( (col('Yards_Gained') <= 20 ) & (col('Yards_Gained') >= -5 ) )\nnfldata.approxQuantile(col='Yards_Gained', probabilities=[0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0], relativeError=0.05)\n\nnumeric_columns     = [c[0] for c in nfldata.dtypes if c[1] not in ['string','timestamp']]\ncategorical_columns = [c[0] for c in nfldata.dtypes if c[1] in ['string']]\ndatetime_columns    = [c[0] for c in nfldata.dtypes if c[1] in ['timestamp']]\n","user":"anonymous","dateUpdated":"2017-11-06T02:16:59+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<hr/>Spark Application Id: application_1509554242062_0007<br/>Spark WebUI: <a href=\"http://edwdemo0.field.hortonworks.com:8088/proxy/application_1509554242062_0007/\">http://edwdemo0.field.hortonworks.com:8088/proxy/application_1509554242062_0007/</a>"}]},"apps":[],"jobName":"paragraph_1508952834153_1278108810","id":"20171025-173354_1603992637","dateCreated":"2017-10-25T17:33:54+0000","dateStarted":"2017-11-06T02:16:59+0000","dateFinished":"2017-11-06T02:17:03+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:503"},{"title":"Data Enrichment & Additional Transformations","text":"%livy.pyspark\n\nnfldata2 = nfldata.withColumn(\"Date\",           col(\"Date\"))                        \\\n                    .withColumn(\"GameID\",       col(\"GameID\").cast(\"int\"))          \\\n                    .withColumn(\"Drive\",        col(\"Drive\").cast(\"int\"))           \\\n                    .withColumn(\"qtr\",          col(\"qtr\").cast(\"int\"))             \\\n                    .withColumn(\"down\",         col(\"down\").cast(\"int\"))            \\\n                    .withColumn(\"time\",         col(\"time\").cast(\"string\"))         \\\n                    .withColumn(\"TimeUnder\",    col(\"TimeUnder\").cast(\"int\"))       \\\n                    .withColumn(\"TimeSecs\",     col(\"TimeSecs\").cast(\"int\"))        \\\n                    .withColumn(\"PlayTimeDiff\", col(\"PlayTimeDiff\").cast(\"int\"))    \\\n                    .withColumn(\"yrdline100\",   col(\"yrdline100\").cast(\"int\"))      \\\n                    .withColumn(\"ydstogo\",      col(\"ydstogo\").cast(\"int\"))         \\\n                    .withColumn(\"ydsnet\",       col(\"ydsnet\").cast(\"int\"))          \\\n                    .withColumn(\"FirstDown\",    col(\"FirstDown\").cast(\"int\"))       \\\n                    .withColumn(\"posteam\",      col(\"posteam\").cast(\"string\"))      \\\n                    .withColumn(\"DefensiveTeam\",col(\"DefensiveTeam\").cast(\"string\"))\\\n                    .withColumn(\"Yards_Gained\", col(\"Yards_Gained\").cast(\"int\"))    \\\n                    .withColumn(\"Touchdown\",    col(\"Touchdown\").cast(\"int\"))       \\\n                    .withColumn(\"PlayType\",     col(\"PlayType\").cast(\"string\"))     \\\n                    .withColumn(\"PassLength\",   col(\"PassLength\").cast(\"string\"))   \\\n                    .withColumn(\"PassLocation\", col(\"PassLocation\").cast(\"string\")) \\\n                    .withColumn(\"RunLocation\",  col(\"RunLocation\").cast(\"string\"))  \\\n                    .withColumn(\"PosTeamScore\", col(\"PosTeamScore\").cast(\"int\"))    \\\n                    .withColumn(\"DefTeamScore\", col(\"DefTeamScore\").cast(\"int\")) \n\n\nnumeric_columns     = [c[0] for c in nfldata2.dtypes if c[1] not in ['string','timestamp']]\ncategorical_columns = [c[0] for c in nfldata2.dtypes if c[1] in ['string']]\ndatetime_columns    = [c[0] for c in nfldata2.dtypes if c[1] in ['timestamp']]\n\n'''\n# Correlation\nseen = []\nfor c1 in numeric_columns:\n    for c2 in numeric_columns:\n        correlation = round(nfldata2.stat.corr(c1, c2), 8)\n        #if (correlation >= 0.90 or correlation <= 0.10) and (c1 != c2) and ((c1,c2) not in seen):\n        if (correlation >= 0.70) and (c1 != c2) and ((c1,c2) not in seen):\n            seen.append((c2,c1))\n            print str(correlation) + '\\tCorrelation for ' + str(c1) + ' and ' + str(c2)\n'''\n\n# Category Levels\n[nfldata2.select(nfldata2[c]).groupBy(nfldata2[c]).count().show(50,False) for c in categorical_columns]","user":"anonymous","dateUpdated":"2017-11-06T02:21:12+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"title":true,"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----+-----+\n|time |count|\n+-----+-----+\n|03:15|34   |\n|02:39|38   |\n|07:24|36   |\n|06:43|37   |\n|04:02|28   |\n|11:01|34   |\n|11:19|39   |\n|00:16|46   |\n|01:45|49   |\n|06:27|39   |\n|09:10|30   |\n|06:46|27   |\n|01:35|47   |\n|12:26|35   |\n|02:52|32   |\n|00:52|54   |\n|12:41|35   |\n|05:34|32   |\n|10:21|47   |\n|10:47|34   |\n|08:10|33   |\n|13:13|36   |\n|13:49|40   |\n|13:56|34   |\n|02:36|51   |\n|00:27|56   |\n|01:01|56   |\n|04:05|32   |\n|10:24|32   |\n|10:08|39   |\n|12:33|35   |\n|07:19|37   |\n|14:47|19   |\n|09:12|33   |\n|06:59|40   |\n|02:10|42   |\n|00:40|66   |\n|00:58|51   |\n|10:51|34   |\n|12:01|32   |\n|10:42|36   |\n|01:57|47   |\n|00:29|58   |\n|00:21|46   |\n|14:22|57   |\n|12:51|35   |\n|10:02|29   |\n|05:22|34   |\n|08:55|39   |\n|04:29|28   |\n+-----+-----+\nonly showing top 50 rows\n\n+----------+-----+\n|PlayType  |count|\n+----------+-----+\n|Field Goal|985  |\n|Run       |12699|\n|No Play   |2463 |\n|QB Kneel  |424  |\n|Timeout   |2    |\n|Spike     |52   |\n|Punt      |2324 |\n|Sack      |392  |\n|Pass      |16713|\n+----------+-----+\n\n+----------+-----+\n|PassLength|count|\n+----------+-----+\n|NA        |18366|\n|Deep      |2755 |\n|Short     |14933|\n+----------+-----+\n\n+------------+-----+\n|PassLocation|count|\n+------------+-----+\n|NA          |18366|\n|left        |6648 |\n|middle      |3924 |\n|right       |7116 |\n+------------+-----+\n\n+-----------+-----+\n|RunLocation|count|\n+-----------+-----+\n|NA         |23473|\n|left       |4536 |\n|middle     |3365 |\n|right      |4680 |\n+-----------+-----+\n\n+-------+-----+\n|posteam|count|\n+-------+-----+\n|NYJ    |1182 |\n|CAR    |1146 |\n|TB     |1121 |\n|OAK    |1113 |\n|DET    |1117 |\n|TEN    |1043 |\n|BUF    |1102 |\n|BAL    |1191 |\n|NE     |1146 |\n|GB     |1172 |\n|JAC    |1072 |\n|DEN    |1162 |\n|ARI    |1116 |\n|SF     |1066 |\n|KC     |1058 |\n|SEA    |1102 |\n|CIN    |1095 |\n|DAL    |1069 |\n|CLE    |1129 |\n|MIA    |1058 |\n|SD     |1223 |\n|STL    |1051 |\n|MIN    |1057 |\n|ATL    |1165 |\n|PHI    |1207 |\n|WAS    |1110 |\n|NYG    |1162 |\n|PIT    |1093 |\n|NO     |1179 |\n|IND    |1169 |\n|HOU    |1247 |\n|CHI    |1131 |\n+-------+-----+\n\n+-------------+-----+\n|DefensiveTeam|count|\n+-------------+-----+\n|NYJ          |1105 |\n|CAR          |1122 |\n|TB           |1154 |\n|OAK          |1200 |\n|DET          |1064 |\n|TEN          |1093 |\n|BUF          |1131 |\n|BAL          |1114 |\n|NE           |1122 |\n|GB           |1102 |\n|JAC          |1213 |\n|DEN          |1169 |\n|ARI          |1069 |\n|SF           |1196 |\n|KC           |1120 |\n|SEA          |1042 |\n|CIN          |1129 |\n|DAL          |1103 |\n|CLE          |1089 |\n|MIA          |1196 |\n|SD           |1037 |\n|STL          |1212 |\n|MIN          |1106 |\n|ATL          |1086 |\n|PHI          |1247 |\n|WAS          |1087 |\n|NYG          |1197 |\n|PIT          |1147 |\n|NO           |1073 |\n|IND          |1161 |\n|HOU          |1095 |\n|CHI          |1073 |\n+-------------+-----+\n\n[None, None, None, None, None, None, None]"},{"type":"HTML","data":"<hr/>Spark Application Id: application_1509554242062_0007<br/>Spark WebUI: <a href=\"http://edwdemo0.field.hortonworks.com:8088/proxy/application_1509554242062_0007/\">http://edwdemo0.field.hortonworks.com:8088/proxy/application_1509554242062_0007/</a>"}]},"apps":[],"jobName":"paragraph_1508953599949_-2038952141","id":"20171025-174639_420468141","dateCreated":"2017-10-25T17:46:39+0000","dateStarted":"2017-11-06T02:21:12+0000","dateFinished":"2017-11-06T02:21:24+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:504"},{"title":"Data Filtering and Enrichment (Continued...)","text":"%livy.pyspark\n\n# Filter - Keep where Playtype in ['Run','Pass'] \nnfldata2 = nfldata2.filter( (nfldata2.PlayType==\"Run\") | (nfldata2.PlayType==\"Pass\") )\n\n# Derive Date var(s)\nnfldata2 = nfldata2.withColumn(\"month_day\", concat(nfldata2[\"Date\"].substr(6,2), nfldata2[\"Date\"].substr(9,2)).cast(\"int\") )\n\n# Lag (Get previous PlayType)\nw = Window().partitionBy('GameID','Drive').orderBy('GameID','Drive', col('TimeSecs').desc())\nnfldata2 = nfldata2.withColumn(\"PlayType_lag\", lag(\"PlayType\").over(w) ) \\\n                 .withColumn(\"PlayType_lag\",  when( isnull('PlayType_lag'), 'FirstPlay').otherwise( col('PlayType_lag') ) ) \\\n                 .orderBy('GameID','Drive', col('TimeSecs').desc())\n\n# Print Results\nnfldata2.select([\"GameID\",\"Drive\",\"qtr\",\"down\",\"TimeSecs\",\"PlayType\",\"PlayType_lag\",\"yrdline100\",\"posteam\",\"DefensiveTeam\",\"month_day\"]).show(10,False)\n","user":"anonymous","dateUpdated":"2017-11-06T02:21:30+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+-----+---+----+--------+--------+------------+----------+-------+-------------+---------+\n|GameID    |Drive|qtr|down|TimeSecs|PlayType|PlayType_lag|yrdline100|posteam|DefensiveTeam|month_day|\n+----------+-----+---+----+--------+--------+------------+----------+-------+-------------+---------+\n|2015091000|1    |1  |1   |3600    |Run     |FirstPlay   |80        |PIT    |NE           |910      |\n|2015091000|1    |1  |1   |3561    |Pass    |Run         |62        |PIT    |NE           |910      |\n|2015091000|1    |1  |2   |3544    |Run     |Pass        |53        |PIT    |NE           |910      |\n|2015091000|1    |1  |1   |3506    |Pass    |Run         |49        |PIT    |NE           |910      |\n|2015091000|1    |1  |1   |3462    |Run     |Pass        |35        |PIT    |NE           |910      |\n|2015091000|1    |1  |2   |3353    |Run     |Run         |42        |PIT    |NE           |910      |\n|2015091000|1    |1  |3   |3328    |Pass    |Run         |36        |PIT    |NE           |910      |\n|2015091000|2    |1  |1   |3280    |Pass    |FirstPlay   |66        |NE     |PIT          |910      |\n|2015091000|2    |1  |1   |3254    |Pass    |Pass        |68        |NE     |PIT          |910      |\n|2015091000|2    |1  |1   |3240    |Pass    |Pass        |56        |NE     |PIT          |910      |\n+----------+-----+---+----+--------+--------+------------+----------+-------+-------------+---------+\nonly showing top 10 rows"},{"type":"HTML","data":"<hr/>Spark Application Id: application_1509554242062_0007<br/>Spark WebUI: <a href=\"http://edwdemo0.field.hortonworks.com:8088/proxy/application_1509554242062_0007/\">http://edwdemo0.field.hortonworks.com:8088/proxy/application_1509554242062_0007/</a>"}]},"apps":[],"jobName":"paragraph_1508953675505_-763970907","id":"20171025-174755_563118345","dateCreated":"2017-10-25T17:47:55+0000","dateStarted":"2017-11-06T02:21:30+0000","dateFinished":"2017-11-06T02:21:34+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:505"},{"text":"%md\n# Model Building\n","user":"anonymous","dateUpdated":"2017-10-31T14:18:12+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Model Building</h1>\n</div>"}]},"apps":[],"jobName":"paragraph_1509418058821_-1892266767","id":"20171031-024738_57502264","dateCreated":"2017-10-31T02:47:38+0000","dateStarted":"2017-10-31T14:18:12+0000","dateFinished":"2017-10-31T14:18:12+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:506"},{"title":"Model Prep (Split into Training and Testing Dataframes, initialize needed functions)","text":"%livy.pyspark\n\n# Split into \"Run\" and \"Pass\" (I want to build two models)\nnfldata2_run  = nfldata2.filter( col('PlayType')=='Run' )\nnfldata2_pass = nfldata2.filter( col('PlayType')=='Pass' )\n\nprint \"Total Number of Records:   \" + str(nfldata2.count())\nprint \"Number of Running Records: \" + str(nfldata2_run.count())\nprint \"Number of Passing Records: \" + str(nfldata2_pass.count())\n\n# Split into Train and Test\ntraining_run, testing_run   = nfldata2_run.randomSplit([0.8, 0.2], seed=12345)\ntraining_pass, testing_pass = nfldata2_pass.randomSplit([0.8, 0.2], seed=12345)\n\ndef get_feature_importance(model=''):\n    featureImportances = model.stages[-1].featureImportances\n    featureImportances = sorted([(round(featureImportances[i],6), feature) for i,feature in enumerate(features)], reverse=True)\n    for i in featureImportances: print str('{0:.6f}'.format(i[0])) + '\\t' + str(i[1])\n","user":"anonymous","dateUpdated":"2017-11-06T03:11:50+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Total Number of Records:   29412\nNumber of Running Records: 12699\nNumber of Passing Records: 16713"},{"type":"HTML","data":"<hr/>Spark Application Id: application_1509554242062_0007<br/>Spark WebUI: <a href=\"http://edwdemo0.field.hortonworks.com:8088/proxy/application_1509554242062_0007/\">http://edwdemo0.field.hortonworks.com:8088/proxy/application_1509554242062_0007/</a>"}]},"apps":[],"jobName":"paragraph_1509934782593_1776251205","id":"20171106-021942_180910807","dateCreated":"2017-11-06T02:19:42+0000","dateStarted":"2017-11-06T03:04:31+0000","dateFinished":"2017-11-06T03:04:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:507"},{"title":"Build Model Pipeline","text":"%livy.pyspark\n\nsi1 = StringIndexer(inputCol=\"PlayType\", outputCol=\"PlayType_index\")\nsi2 = StringIndexer(inputCol=\"PlayType_lag\", outputCol=\"PlayType_lag_index\")\nsi3 = StringIndexer(inputCol=\"PassLength\", outputCol=\"PassLength_index\")\nsi4 = StringIndexer(inputCol=\"PassLocation\", outputCol=\"PassLocation_index\")\nsi5 = StringIndexer(inputCol=\"RunLocation\", outputCol=\"RunLocation_index\")\nsi6 = StringIndexer(inputCol=\"posteam\", outputCol=\"posteam_index\")\nsi7 = StringIndexer(inputCol=\"DefensiveTeam\", outputCol=\"DefensiveTeam_index\") \ntarget    = 'Yards_Gained'\nfeatures  = ['qtr','down','TimeSecs','yrdline100','ydstogo','ydsnet','posteam_index','DefensiveTeam_index','month_day','PlayType_lag_index']\n#features = ['Drive','qtr','down','TimeSecs','yrdline100','ydstogo','ydsnet','month_day','PlayType_lag_index']\n#features = ['Drive','qtr','down','TimeUnder','TimeSecs','PlayTimeDiff','yrdline100','ydstogo','ydsnet','PlayType_index','PassLength_index','PassLocation_index','RunLocation_index','month_day','PlayType_lag_index']\nva  = VectorAssembler(inputCols=features, outputCol=\"features\")\nrfr = RandomForestRegressor(featuresCol=\"features\", labelCol=target, predictionCol=\"prediction\", maxDepth=5, maxBins=350, seed=12345)\ngbr = GBTRegressor(featuresCol=\"features\", labelCol=target, predictionCol=\"prediction\", maxDepth=5, maxBins=350, seed=12345)\n\npipeline_stages = [si2, si6, si7, va, gbr]\n","user":"anonymous","dateUpdated":"2017-11-06T03:04:37+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<hr/>Spark Application Id: application_1509554242062_0007<br/>Spark WebUI: <a href=\"http://edwdemo0.field.hortonworks.com:8088/proxy/application_1509554242062_0007/\">http://edwdemo0.field.hortonworks.com:8088/proxy/application_1509554242062_0007/</a>"}]},"apps":[],"jobName":"paragraph_1508954051874_-1674518311","id":"20171025-175411_852588047","dateCreated":"2017-10-25T17:54:11+0000","dateStarted":"2017-11-06T03:04:37+0000","dateFinished":"2017-11-06T03:04:41+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:508"},{"title":"Build Model - Predict Yards Gained for Running Plays","text":"%livy.pyspark\n\npipeline_run  = Pipeline(stages=pipeline_stages)\nmodel_run     = pipeline_run.fit(training_run)\nmodel_run.write().overwrite().save('/models/nfl_model_run')\n\nget_feature_importance(model=model_run)\n\n# Make predictions.\npredictions = model_run.transform(testing_run)\npredictions.select(\"prediction\", target).show(10,False)\n\n# Evaluate Results\nevaluator = RegressionEvaluator(metricName=\"rmse\", labelCol=target)  # rmse (default)|mse|r2|mae\nRMSE = evaluator.evaluate(predictions)\nprint 'RMSE: ' + str(RMSE)\n\nevaluator = RegressionEvaluator(metricName=\"mae\", labelCol=target)  # rmse (default)|mse|r2|mae\nMAE = evaluator.evaluate(predictions) # Mean Absolute Error\nprint 'MSE: ' + str(MAE)\n","user":"anonymous","dateUpdated":"2017-11-06T03:12:07+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"title":true,"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"0.285447\tydsnet\n0.206441\tDefensiveTeam_index\n0.203587\tposteam_index\n0.140114\tyrdline100\n0.076030\tydstogo\n0.039610\tdown\n0.026611\tPlayType_lag_index\n0.010744\tTimeSecs\n0.006345\tmonth_day\n0.005070\tqtr\n+------------------+------------+\n|prediction        |Yards_Gained|\n+------------------+------------+\n|6.537936438307972 |6           |\n|2.140405097734539 |1           |\n|1.7435847248489182|1           |\n|3.1140996350585324|8           |\n|0.9371099813607104|0           |\n|3.8071422159195385|1           |\n|3.5053600639314753|-1          |\n|5.352175224262828 |5           |\n|-2.122853038948072|-2          |\n|3.780274617582594 |5           |\n+------------------+------------+\nonly showing top 10 rows\n\nRMSE: 3.12790169007\nMSE: 2.18351913258"},{"type":"HTML","data":"<hr/>Spark Application Id: application_1509554242062_0007<br/>Spark WebUI: <a href=\"http://edwdemo0.field.hortonworks.com:8088/proxy/application_1509554242062_0007/\">http://edwdemo0.field.hortonworks.com:8088/proxy/application_1509554242062_0007/</a>"}]},"apps":[],"jobName":"paragraph_1508954120973_1980485681","id":"20171025-175520_1817322250","dateCreated":"2017-10-25T17:55:20+0000","dateStarted":"2017-11-06T03:12:07+0000","dateFinished":"2017-11-06T03:18:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:509"},{"title":"Build Model - Predict Yards Gained for Passing Plays","text":"%livy.pyspark\n\npipeline_pass = Pipeline(stages=pipeline_stages)\nmodel_pass    = pipeline_pass.fit(training_pass)\nmodel_pass.write().overwrite().save('/models/nfl_model_pass')\n\nget_feature_importance(model=model_pass)\n\n# Evaluate Results\nevaluator = RegressionEvaluator(metricName=\"rmse\", labelCol=target)  # rmse (default)|mse|r2|mae\nRMSE = evaluator.evaluate(predictions)\nprint 'RMSE: ' + str(RMSE)\n\nevaluator = RegressionEvaluator(metricName=\"mae\", labelCol=target)  # rmse (default)|mse|r2|mae\nMAE = evaluator.evaluate(predictions) # Mean Absolute Error\nprint 'MSE: ' + str(MAE)\n","user":"anonymous","dateUpdated":"2017-11-06T03:29:07+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"0.325654\tydsnet\n0.208597\tyrdline100\n0.183870\tposteam_index\n0.157204\tDefensiveTeam_index\n0.061446\tydstogo\n0.021992\tPlayType_lag_index\n0.014585\tdown\n0.013152\tTimeSecs\n0.011838\tmonth_day\n0.001663\tqtr\nRMSE: 4.0872349258\nMSE: 3.08198974049"},{"type":"HTML","data":"<hr/>Spark Application Id: application_1509554242062_0007<br/>Spark WebUI: <a href=\"http://edwdemo0.field.hortonworks.com:8088/proxy/application_1509554242062_0007/\">http://edwdemo0.field.hortonworks.com:8088/proxy/application_1509554242062_0007/</a>"}]},"apps":[],"jobName":"paragraph_1508954194397_-1498505818","id":"20171025-175634_311353532","dateCreated":"2017-10-25T17:56:34+0000","dateStarted":"2017-11-06T03:29:08+0000","dateFinished":"2017-11-06T03:35:34+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:510"},{"text":"%livy.pyspark\n\n","user":"anonymous","dateUpdated":"2017-11-06T03:22:34+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1508954723864_-1067439266","id":"20171025-180523_1742791334","dateCreated":"2017-10-25T18:05:23+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:511"}],"name":"NFL_Predictions_Zeppelin","id":"2CYJ166F2","angularObjects":{"2CXNSCZYJ:shared_process":[],"2CYRH9TG3:shared_process":[],"2CX9SZ1V9:shared_process":[],"2CW9U9BFX:shared_process":[],"2CWTXZ147:shared_process":[],"2CZ146K6R:shared_process":[],"2CVYM955S:shared_process":[],"2CY61FDAU:shared_process":[],"2CWJ688T8:shared_process":[],"2CY7VEP1E:shared_process":[],"2CWDKDM59:shared_process":[],"2CYHPK6WK:shared_process":[],"2CVSX24TP:shared_process":[],"2CW7D715V:shared_process":[],"2CZ93Q4YT:shared_process":[],"2CWSJ9KVF:shared_process":[],"2CVW9FMKE:shared_process":[],"2CWF3R78G:shared_process":[],"2CYD6ASDG:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}